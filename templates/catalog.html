{% load static %}
<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>gagasan - Repository Produk Digital Terkurasi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      /* Custom Animations */
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .animate-slide-in {
        animation: slideIn 0.3s ease-out;
      }
      
      {
    scroll-behavior: smooth;
  }
  
  section, div[id] {
    scroll-margin-top: 100px; 
  }

      /* Grid Card Animation for Attractive Loading (BARU) */
      .grid-card-animation {
        animation: slideIn 0.5s ease-out forwards;
        opacity: 0;
      }
      
      /* Card Hover Effect */
      .card-hover {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .card-hover:hover {
        transform: translateY(-4px);
        box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1),
          0 8px 10px -6px rgb(0 0 0 / 0.1);
      }

      /* Hover Effect for Static/Feature Cards (BARU) */
      .feature-card {
        transition: all 0.2s ease-in-out;
      }
      .feature-card:hover {
        box-shadow: 0 8px 15px -3px rgba(147, 51, 234, 0.1), 0 4px 6px -2px rgba(147, 51, 234, 0.05);
        transform: translateY(-3px);
        border-color: #A78BFA; /* purple-300 */
      }

      /* Grid Pattern */
      .bg-grid-pattern {
        background-image: linear-gradient(
            to right,
            rgb(0 0 0 / 0.05) 1px,
            transparent 1px
          ),
          linear-gradient(to bottom, rgb(0 0 0 / 0.05) 1px, transparent 1px);
        background-size: 40px 40px;
      }

      /* Custom Scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: #d1d5db;
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #9ca3af;
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <header
      class="bg-white/80 backdrop-blur-lg border-b sticky top-0 z-50 shadow-sm"
    >
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <img src="{% static 'images/LOGO GAGASAN.png' %}" alt="Logo Gagasan" class="h-12 w-12 rounded-lg bg-white/30 p-1"/>
            <div>
              <h1 class="text-xl font-semibold">GAGASAN</h1>
              <p class="text-xs text-gray-600">Dari Gagasan Jadi Inovasi</p>
            </div>
          </div>
          
          {% if request.user.is_authenticated %}
          <div class="flex items-center gap-3">
             <a
              href="{% if request.user.peran == 'mahasiswa' %}{% url 'dashboard_mahasiswa' %}{% elif request.user.peran == 'dosen' %}{% url 'dashboard_dosen' %}{% elif request.user.peran == 'mitra' %}{% url 'dashboard_mitra' %}{% elif request.user.peran == 'unit_bisnis' %}{% url 'dashboard_unit_bisnis' %}{% else %}{% url 'admin:index' %}{% endif %}" 
              class="flex items-center gap-2 px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-lg transition-all text-sm font-medium"
            >
              <i class="fas fa-tachometer-alt"></i>
              Dashboard
            </a>
             <a
              href="{% url 'logout' %}"
              class="flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-all text-sm font-medium"
            >
              <i class="fas fa-sign-out-alt"></i>
              Logout
            </a>
          </div>
          {% else %}
          <a
            href="{% url 'login' %}"
            class="flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white rounded-lg transition-all"
          >
            <i class="fas fa-sign-in-alt"></i>
            Login
          </a>
          {% endif %}
        </div>
      </div>
    </header>

    <section
      class="relative bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-50 overflow-hidden"
    >
      <div class="absolute inset-0 bg-grid-pattern opacity-5"></div>
      <div
        class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 sm:py-24 relative"
      >
        <div class="grid lg:grid-cols-2 gap-12 items-center">
          <div>
            <div
              class="inline-flex items-center gap-2 px-4 py-2 bg-white rounded-full shadow-sm mb-6"
            >
              <i class="fas fa-sparkles text-yellow-500"></i>
              <span class="text-sm">Hanya Produk Terkurasi Berkualitas</span>
            </div>
            <h1
              class="text-4xl sm:text-5xl lg:text-6xl font-bold mb-6 bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent"
            >
              Repository Inovasi Digital
            </h1>
            <p class="text-lg text-gray-600 mb-8 leading-relaxed">
              Jelajahi koleksi proyek mahasiswa terbaik yang telah dikurasi oleh
              dosen dan praktisi industri. Temukan inspirasi untuk proyek Anda
              berikutnya.
            </p>
            <div class="flex flex-wrap gap-4">
              <a
                href="#projects-section"
                id="scrollToProjects"
                class="px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white rounded-lg font-medium transition-all inline-flex items-center gap-2"
              >
                Mulai Jelajah
                <i class="fas fa-chevron-down"></i>
              </a>
            </div>
          </div>

          <div class="relative hidden lg:block">
            <div class="relative rounded-2xl overflow-hidden shadow-2xl">
              <img
                src="https://images.unsplash.com/photo-1658806283210-6d7330062704?w=1080"
                alt="Innovation"
                class="w-full h-[400px] object-cover"
              />
              <div
                class="absolute inset-0 bg-gradient-to-t from-purple-900/50 to-transparent"
              ></div>
            </div>
            <div
              class="absolute -top-4 -right-4 bg-white p-4 rounded-xl shadow-xl"
            >
              <i class="fas fa-award text-yellow-500 text-3xl"></i>
            </div>
          </div>
        </div>
      </div>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16">

        <!-- TOP STAT -->
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-8 text-center mb-16">
            
            <div class="space-y-2 feature-card transition-all duration-300 hover:-translate-y-2 hover:shadow-xl hover:bg-gray-50 rounded-xl p-4">
                <div class="inline-flex w-16 h-16 bg-purple-100 rounded-full items-center justify-center mb-2 group transition-transform duration-300 hover:rotate-[8deg]">
                    <i class="fas fa-rocket text-purple-600 text-2xl"></i>
                </div>
                <p class="text-4xl font-bold text-gray-900 transition-transform duration-300 group-hover:scale-110">12+</p>
                <p class="text-sm font-medium text-gray-500">Produk Terkurasi</p>
            </div>

            <div class="space-y-2 feature-card transition-all duration-300 hover:-translate-y-2 hover:shadow-xl hover:bg-gray-50 rounded-xl p-4">
                <div class="inline-flex w-16 h-16 bg-blue-100 rounded-full items-center justify-center mb-2 group transition-transform duration-300 hover:rotate-[8deg]">
                    <i class="fas fa-list-ul text-blue-600 text-2xl"></i>
                </div>
                <p class="text-4xl font-bold text-gray-900 transition-transform duration-300 group-hover:scale-110">16</p>
                <p class="text-sm font-medium text-gray-500">Kategori</p>
            </div>

            <div class="space-y-2 feature-card transition-all duration-300 hover:-translate-y-2 hover:shadow-xl hover:bg-gray-50 rounded-xl p-4">
                <div class="inline-flex w-16 h-16 bg-green-100 rounded-full items-center justify-center mb-2 group transition-transform duration-300 hover:rotate-[8deg]">
                    <i class="fas fa-check-circle text-green-600 text-2xl"></i>
                </div>
                <p class="text-4xl font-bold text-gray-900 transition-transform duration-300 group-hover:scale-110">100%</p>
                <p class="text-sm font-medium text-gray-500">Terkurasi</p>
            </div>

            <div class="space-y-2 feature-card transition-all duration-300 hover:-translate-y-2 hover:shadow-xl hover:bg-gray-50 rounded-xl p-4">
                <div class="inline-flex w-16 h-16 bg-orange-100 rounded-full items-center justify-center mb-2 group transition-transform duration-300 hover:rotate-[8deg]">
                    <i class="fas fa-award text-orange-600 text-2xl"></i>
                </div>
                <p class="text-4xl font-bold text-gray-900 transition-transform duration-300 group-hover:scale-110">Terpercaya</p>
                <p class="text-sm font-medium text-gray-500">Berkualitas Tinggi</p>
            </div>

        </div>


        <!-- TITLE -->
        <div class="text-center mb-12">
            <h2 class="text-3xl font-bold text-gray-900 mb-2">Mengapa gagasan?</h2>
            <p class="text-lg text-gray-600">Platform terpercaya untuk menemukan dan berbagi inovasi digital berkualitas tinggi</p>
        </div>


        <!-- FEATURE CARDS -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">

            <div class="bg-gray-50 p-6 rounded-xl border border-gray-200 shadow-md feature-card transition-all duration-300 hover:-translate-y-2 hover:shadow-xl hover:bg-white">
                <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center mb-4 group transition-transform duration-300 hover:rotate-[12deg]">
                    <i class="fas fa-lightbulb text-purple-600 text-xl"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Kurasi Berkualitas</h3>
                <p class="text-sm text-gray-600">Setiap proyek dinilai oleh dosen dan praktisi industri untuk memastikan kualitas tertinggi</p>
            </div>

            <div class="bg-gray-50 p-6 rounded-xl border border-gray-200 shadow-md feature-card transition-all duration-300 hover:-translate-y-2 hover:shadow-xl hover:bg-white">
                <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mb-4 group transition-transform duration-300 hover:rotate-[12deg]">
                    <i class="fas fa-book-open text-blue-600 text-xl"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Beragam Kategori</h3>
                <p class="text-sm text-gray-600">Dari Web Development hingga AI, temukan proyek dari 16 kategori teknologi berbeda</p>
            </div>

            <div class="bg-gray-50 p-6 rounded-xl border border-gray-200 shadow-md feature-card transition-all duration-300 hover:-translate-y-2 hover:shadow-xl hover:bg-white">
                <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mb-4 group transition-transform duration-300 hover:rotate-[12deg]">
                    <i class="fas fa-lock text-green-600 text-xl"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Source Code/Asset Terlindungi</h3>
                <p class="text-sm text-gray-600">Akses source code/asset hanya diberikan setelah approval untuk mencegah penyalahgunaan</p>
            </div>

        </div>

    </div>
</section>
    
   
    </section>

    <section id="projects-section" class="bg-white border-b sticky top-[72px] z-40 shadow-sm">
      <section class="bg-white border-b">
    <section class="border-b bg-white"></section>

    <section
      class="bg-gradient-to-br from-gray-50 to-gray-100 border-b"
    ></section>

    <section id="projects-section" class="bg-white border-b sticky top-[72px] z-40 shadow-sm transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-8">
              <div class="flex items-center gap-2 mb-4 text-gray-800">
                <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center text-purple-600">
                   <i class="fas fa-filter text-sm"></i>
                </div>
                <h3 class="font-bold text-lg">Filter & Pencarian</h3>
              </div>

              <form method="GET" action="{% url 'catalog' %}">
                <div class="grid grid-cols-1 md:grid-cols-12 gap-5">
            
                  <div class="md:col-span-4">
                    <label class="block text-xs font-semibold text-gray-500 mb-1.5 ml-1 uppercase tracking-wider">Kata Kunci</label>
                    <div class="relative group">
                      <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fas fa-search text-gray-400 group-focus-within:text-purple-500 transition-colors"></i>
                      </div>
                      <input
                        type="text"
                        name="q"
                        placeholder="Cari judul, deskripsi, atau inovator..."
                        class="w-full pl-10 pr-4 py-2.5 bg-gray-50 border border-gray-200 text-gray-900 text-sm rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent focus:bg-white transition-all duration-200 placeholder-gray-400"
                        value="{{ current_query|default:'' }}"
                      />
                    </div>
                  </div>
              
                  <div class="md:col-span-3">
                    <label class="block text-xs font-semibold text-gray-500 mb-1.5 ml-1 uppercase tracking-wider">Kategori</label>
                    <div class="relative">
                      <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fas fa-tags text-gray-400"></i>
                      </div>
                      <select
                        name="category"
                        class="w-full pl-10 pr-8 py-2.5 bg-gray-50 border border-gray-200 text-gray-700 text-sm rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent focus:bg-white cursor-pointer appearance-none transition-all duration-200"
                      >
                        <option value="" class="text-gray-400">Semua Kategori</option>
                        {% for cat in categories_list %}
                          <option value="{{ cat.slug }}" {% if current_category_slug == cat.slug %}selected{% endif %}>
                            {{ cat.nama }}
                          </option>
                        {% endfor %}
                      </select>
                      <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                        <i class="fas fa-chevron-down text-gray-400 text-xs"></i>
                      </div>
                    </div>
                  </div>

                  <div class="md:col-span-2">
                      <label class="block text-xs font-semibold text-gray-500 mb-1.5 ml-1 uppercase tracking-wider">Urutkan</label>
                      <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                          <i class="fas fa-sort-amount-down text-gray-400"></i>
                        </div>
                        <select
                          name="sort"
                          class="w-full pl-10 pr-8 py-2.5 bg-gray-50 border border-gray-200 text-gray-700 text-sm rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent focus:bg-white cursor-pointer appearance-none transition-all duration-200"
                        >
                          <option value="terbaru" {% if current_sort == 'terbaru' %}selected{% endif %}>Terbaru</option>
                          <option value="terlama" {% if current_sort == 'terlama' %}selected{% endif %}>Terlama</option>
                        </select>
                        <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                          <i class="fas fa-chevron-down text-gray-400 text-xs"></i>
                        </div>
                      </div>
                    </div>
              
                  <div class="md:col-span-3 grid grid-cols-2 gap-2">
                    <div>
                      <label class="block text-xs font-semibold text-gray-500 mb-1.5 ml-1 uppercase tracking-wider">Mulai</label>
                      <input
                        type="date"
                        name="start_date"
                        class="w-full px-3 py-2.5 bg-gray-50 border border-gray-200 text-gray-700 text-sm rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent focus:bg-white transition-all duration-200"
                        value="{{ current_start_date|default:'' }}"
                      >
                    </div>
                    <div>
                      <label class="block text-xs font-semibold text-gray-500 mb-1.5 ml-1 uppercase tracking-wider">Selesai</label>
                      <input
                        type="date"
                        name="end_date"
                        class="w-full px-3 py-2.5 bg-gray-50 border border-gray-200 text-gray-700 text-sm rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent focus:bg-white transition-all duration-200"
                        value="{{ current_end_date|default:'' }}"
                      >
                    </div>
                  </div>
              
                  <div class="md:col-span-12 flex flex-col sm:flex-row gap-3 pt-2 border-t border-gray-100 mt-2">
                    <button
                      type="submit"
                      class="flex-1 sm:flex-none px-6 py-2.5 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white font-medium rounded-xl shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-200 flex items-center justify-center gap-2"
                    >
                      <i class="fas fa-search"></i>
                      Terapkan Filter
                    </button>

                    {% if current_query or current_category_slug or current_start_date or current_end_date %}
                    <a 
                      href="{% url 'catalog' %}" 
                      class="flex-1 sm:flex-none px-6 py-2.5 bg-white border border-gray-200 text-gray-600 hover:bg-gray-50 hover:text-red-600 font-medium rounded-xl transition-all duration-200 flex items-center justify-center gap-2 group"
                    >
                      <i class="fas fa-undo group-hover:rotate-[-45deg] transition-transform duration-300"></i>
                      Reset
                    </a>
                    {% endif %}
                  </div>
              
                </div>
              </form>
            </div>
            <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                <div class="text-gray-600 text-sm">
                    Menampilkan 
                    <span class="font-bold text-gray-900 text-lg mx-1">{{ projects|length }}</span> 
                    produk inovasi unggulan
                </div>
                
                <div class="flex items-center gap-2">
                   {% if current_query or current_category_slug or current_start_date or current_end_date %}
                      <span class="px-3 py-1 bg-purple-50 text-purple-700 text-xs font-medium rounded-full border border-purple-100 animate-pulse">
                        <i class="fas fa-filter mr-1"></i> Filter Aktif
                      </span>
                   {% endif %}
                   <span class="inline-flex items-center gap-1.5 px-4 py-1.5 bg-green-50 text-green-700 border border-green-200 rounded-full text-xs font-bold shadow-sm">
                      <i class="fas fa-check-circle"></i>
                      Terverifikasi Unit Bisnis
                  </span>
                </div>
            </div>
        </div>
    </section>

    <section class="bg-gradient-to-b from-white to-gray-50">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3" id="projectsGrid">
          {% for project in projects %}
          <div
            class="card-hover cursor-pointer overflow-hidden rounded-xl border-0 shadow-md bg-white flex flex-col h-[460px]"
            onclick="openModal('{{ project.id }}')"
          >
            <div class="relative overflow-hidden">
              <div class="aspect-video bg-gray-200">
                {% if project.poster_image %}
                <img
                  src="{{ project.poster_image.url }}"
                  alt="{{ project.title }}"
                  class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
                  onerror="this.onerror=null;this.src='https://placehold.co/800x450/e2e8f0/cbd5e1?text=Gambar+tidak+tersedia';"
                />
                {% else %}
                <img
                  src="https://placehold.co/800x450/e2e8f0/cbd5e1?text=Gambar+tidak+tersedia"
                  alt="Placeholder"
                  class="w-full h-full object-cover"
                />
                {% endif %}
              </div>
              <div class="absolute top-3 right-3">
                  <span
                    {# Class untuk mengatur ukuran badge dan efek blur #}
                    class="inline-flex items-center justify-center w-10 h-10 p-1 bg-white/95 backdrop-blur-sm rounded-full shadow-lg"
                    {# Menggunakan attribute title untuk menampilkan nilai akhir sebagai tooltip #}
                    title="Produk Terkurasi - Nilai Akhir: {{ project.kurasi.nilai_akhir_final|floatformat:2|default:'N/A' }}/4.00"
                  >
                      {# Masukkan gambar logo Curated_symbol.png #}
                      {# Asumsi: File Curated_symbol.png sudah ada di folder static/images/ #}
                      <img 
                          src="{% static 'images/Curated_symbol.png' %}" 
                          alt="Logo Produk Terkurasi" 
                          class="w-full h-full object-contain"
                      />
                  </span>
              </div>
            </div>
            <div class="p-4 flex flex-col justify-between flex-grow overflow-hidden">
              <div class="mb-2">
                <h3
                  class="font-semibold text-lg line-clamp-2 group-hover:text-purple-600 transition-colors"
                >
                  {{ project.title }}
                </h3>
              </div>
              <div class="mb-2 h-10 overflow-hidden">
                 {% for cat in project.kategori.all %}
                    <span class="inline-block px-2 py-1 border border-gray-300 rounded text-xs mb-1">{{ cat.nama }}</span>
                 {% empty %}
                    <span class="text-xs text-gray-400 italic">Tanpa Kategori</span>
                 {% endfor %}
              </div>
              

              <p class="text-sm text-gray-600 line-clamp-2 mb-3">
                {{ project.description }}
              </p>

              <div class="flex items-center gap-2 text-sm text-gray-500 mb-3">
                <div
                  class="w-6 h-6 bg-gradient-to-br from-purple-400 to-blue-400 rounded-full flex items-center justify-center"
                >
                  <i class="fas fa-user text-white text-xs"></i>
                </div>
                <span class="text-xs">{{ project.id_pemilik.username }}</span>
              </div>
              <div class="flex flex-wrap gap-1">
                 {% for tag in project.tags.all|slice:":3" %}
                    <span class="px-2 py-1 bg-gray-100 text-gray-700 rounded text-xs">{{ tag.nama }}</span>
                 {% endfor %}
                 {% if project.tags.count > 3 %}
                    <span class="px-2 py-1 bg-gray-50 text-gray-500 rounded text-xs">+{{ project.tags.count|add:"-3" }} more</span>
                 {% endif %}
              </div>
            </div>
          </div>
          {% empty %}
          <div class="col-span-3 text-center py-12">
            <i class="fas fa-box-open text-gray-400 text-4xl mb-4"></i>
            <h3 class="text-xl font-semibold text-gray-700">
              Belum Ada Proyek
            </h3>
            <p class="text-gray-500">
              Belum ada proyek yang dipublikasikan. Silakan cek kembali nanti.
            </p>
          </div>
          {% endfor %}
        </div>
      </div>
    </section>

    <section class="bg-gradient-to-br from-purple-600 to-blue-600 text-white">
    
    </section>

    <footer class="bg-gray-900 text-gray-300 py-8">
         <div class="max-w-7xl mx-auto px-4 text-center">
             <p>&copy; 2025 Gagasan - Politeknik Negeri Jakarta</p>
         </div>
    </footer>

    <div
      id="projectModal"
      class="hidden fixed inset-0 bg-black bg-opacity-60 z-[60] flex items-center justify-center p-4 backdrop-blur-sm overflow-y-auto"
    ></div>

    <script>
      // Mengirim data dari Django ke JavaScript
      const projectsData = [
          {% for project in projects %}
          {
              id: {{ project.id }},
              title: "{{ project.title|escapejs }}",
              description: "{{ project.description|escapejs|linebreaksbr }}",
              category: "{% for cat in project.kategori.all %}{{ cat.nama|escapejs }}{% if not forloop.last %}, {% endif %}{% endfor %}",
              studentName: "{{ project.id_pemilik.username|escapejs }}",
              // Gunakan placeholder jika data tidak ada di model
              department: "Teknik Informatika & Komputer",
              submissionDate: "{{ project.created_at|date:'d M Y' }}",
              projectImage: "{% if project.poster_image %}{{ project.poster_image.url }}{% else %}https://placehold.co/800x450/e2e8f0/cbd5e1?text=Gambar+tidak+tersedia{% endif %}",
              tags: [{% for tag in project.tags.all %}"{{ tag.nama|escapejs }}"{% if not forloop.last %},{% endif %}{% endfor %}],
              score: "{{ project.kurasi.nilai_akhir_final|floatformat:2|default:'N/A' }}"
          },
          {% endfor %}
      ];

      // Modal functions
      function openModal(projectId) {
          const id = parseInt(projectId);
          const project = projectsData.find(p => p.id === id);
          if (!project) return;

          // Encode data untuk mailto agar aman di URL
          const emailSubject = encodeURIComponent(`Ketertarikan pada Proyek: ${project.title}`);
          const emailBody = encodeURIComponent(
              `Halo Unit Bisnis,\n\n` +
              `Saya tertarik untuk mengetahui lebih lanjut atau berkolaborasi mengenai proyek "${project.title}" ` +
              `yang dibuat oleh ${project.studentName}.\n\n` +
              `Mohon informasi lebih lanjut mengenai langkah selanjutnya.\n\n` +
              `Terima kasih.`
          );
          const emailLink = `mailto:unitbisnis@pnj.ac.id?subject=${emailSubject}&body=${emailBody}`;


          document.getElementById('projectModal').innerHTML = `
          <div class="bg-white rounded-xl max-w-4xl w-full shadow-2xl transform transition-all flex flex-col max-h-[90vh]">
              <div class="p-6 border-b flex items-start justify-between sticky top-0 bg-white z-10 rounded-t-xl">
                  <div class="flex-1 pr-4">
                      <h2 class="text-2xl font-bold text-gray-900 mb-1">${project.title}</h2>
                      <div class="flex flex-wrap items-center gap-2 text-sm text-gray-500">
                          <span class="bg-purple-100 text-purple-700 px-2.5 py-0.5 rounded-full text-xs font-medium">${project.category || 'Umum'}</span>
                          <span>â€¢</span>
                          <span>${project.department}</span>
                      </div>
                  </div>
                  <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 text-3xl leading-none">&times;</button>
              </div>

              <div class="p-6 overflow-y-auto">
                  <div class="mb-6 relative rounded-xl overflow-hidden bg-gray-100">
                      <img src="${project.projectImage}" alt="${project.title}" class="w-full h-auto max-h-[400px] object-contain mx-auto">
                       <div class="absolute top-4 right-4">
                            <span class="inline-flex items-center gap-1.5 px-3 py-1.5 bg-white/95 backdrop-blur-md text-green-700 border border-green-100 rounded-full text-sm font-bold shadow-lg">
                                <i class="fas fa-award text-yellow-500"></i>
                                ${project.score}/4.00
                            </span>
                        </div>
                  </div>

                  <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                      <div class="md:col-span-2 space-y-6">
                          <div>
                              <h4 class="text-lg font-semibold text-gray-900 mb-3">Deskripsi Proyek</h4>
                              <div class="text-gray-600 leading-relaxed text-sm space-y-2">
                                  ${project.description}
                              </div>
                          </div>
                          
                          <div>
                              <h4 class="text-sm font-semibold text-gray-900 mb-2">Teknologi yang Digunakan</h4>
                              <div class="flex flex-wrap gap-2">
                                  ${project.tags.length > 0 
                                      ? project.tags.map(tag => `<span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium border border-gray-200">${tag}</span>`).join('')
                                      : '<span class="text-gray-400 text-xs italic">Tidak ada tags</span>'
                                  }
                              </div>
                          </div>
                      </div>

                      <div class="space-y-6">
                          <div class="bg-gray-50 p-4 rounded-xl border border-gray-100">
                              <h4 class="text-sm font-semibold text-gray-900 mb-3 uppercase tracking-wider">Informasi Pembuat</h4>
                              <div class="flex items-center gap-3 mb-3">
                                  <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold shadow-sm">
                                      ${project.studentName.charAt(0).toUpperCase()}
                                  </div>
                                  <div>
                                      <p class="text-sm font-medium text-gray-900">${project.studentName}</p>
                                      <p class="text-xs text-gray-500">Mahasiswa</p>
                                  </div>
                              </div>
                              <div class="pt-3 border-t border-gray-200">
                                  <p class="text-xs text-gray-500 mb-1">Tanggal Publikasi</p>
                                  <p class="text-sm font-medium text-gray-900">${project.submissionDate}</p>
                              </div>
                          </div>
                      </div>
                  </div>
              </div>

              <div class="p-6 border-t bg-gray-50 flex flex-col sm:flex-row gap-3 justify-end rounded-b-xl">
                  <button onclick="closeModal()" class="px-5 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 transition-colors font-medium text-sm">
                      Tutup
                  </button>
                  <a href="${emailLink}" class="px-5 py-2.5 bg-gradient-to-r from-purple-600 to-blue-600 text-white rounded-lg hover:from-purple-700 hover:to-blue-700 transition-all shadow-md hover:shadow-lg font-medium text-sm flex items-center justify-center gap-2">
                      <i class="fas fa-envelope"></i>
                      Tertarik? Hubungi Unit Bisnis
                  </a>
              </div>
          </div>`;

          document.getElementById('projectModal').classList.remove('hidden');
          document.body.style.overflow = 'hidden'; // Disable scroll body
      }

      function closeModal() {
          document.getElementById('projectModal').classList.add('hidden');
          document.body.style.overflow = 'auto'; // Enable scroll body
      }

      // Close modal on outside click
      document.getElementById('projectModal').addEventListener('click', function(e) {
          if (e.target === this) closeModal();
      });

      document.getElementById("scrollToProjects").addEventListener("click", function (e) {
    e.preventDefault();
    const target = document.querySelector("#projects-section");
    const offsetTop = target.offsetTop - 80; // biar ga ketutup header

    window.scrollTo({
        top: offsetTop,
        behavior: "smooth"
    });
});
    </script>
  </body>
</html>